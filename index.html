<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLCH - Claquettes Chaussettes</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="fonts/fonts.css">
  <!-- WalletConnect Web3Modal -->
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.9/dist/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.1/dist/web3.min.js"></script>
  <!-- Firebase pour les notifications -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics-compat.js"></script>
  <style>
    html {
      scroll-behavior: smooth;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'A Attack Graffiti', 'Permanent Marker', cursive;
      background: url('fond.png') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      overflow-x: hidden;
    }
    .title-banner {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 10rem; /* Augmentation de la taille */
      color: #f5c400;
      text-shadow: 6px 6px 0 #000; /* Ombre plus prononcée */
      z-index: 10;
      letter-spacing: 8px; /* Espacement des lettres augmenté */
      transform: rotate(-2deg);
    }
    header {
      position: relative;
      height: 250px; /* Augmentation de la hauteur */
    }
    nav {
      text-align: center;
      margin-top: 280px; /* Ajusté pour s'adapter à la hauteur du header */
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 0 1rem;
    }
    nav a {
      text-decoration: none;
      background: #000;
      color: #f5c400;
      padding: 1rem 2rem; /* Boutons plus grands */
      border-radius: 10px;
      font-size: 1.8rem; /* Texte plus grand */
      transition: 0.3s;
      font-family: 'Bangers', cursive;
      min-width: 180px; /* Largeur minimale pour uniformité */
      box-shadow: 4px 4px 0 #000;
    }
    nav a:hover {
      background: #f5c400;
      color: #000;
      transform: scale(1.05) rotate(-2deg);
      box-shadow: 6px 6px 0 #000;
    }
    section {
      padding: 4rem 2rem;
      text-align: center;
    }
    section h2 {
      font-size: 2.8rem;
      margin-bottom: 1.5rem;
      letter-spacing: 2px;
      text-shadow: 3px 3px 0 #000;
      transform: rotate(-1deg);
      display: inline-block;
    }
    section p {
      font-family: 'Bangers', cursive;
      font-size: 1.4rem;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }
    #home .hero-text {
      font-size: 2.5rem;
      color: #f5c400;
      margin-bottom: 2rem;
      letter-spacing: 2px;
      line-height: 1.4;
      text-shadow: 3px 3px 0 #000;
      transform: rotate(-1deg);
    }
    .btn-post {
      display: inline-block;
      margin-top: 2rem;
      padding: 1rem 2rem;
      background-color: #f5c400;
      color: #000;
      font-size: 1.6rem;
      border-radius: 10px;
      text-decoration: none;
      box-shadow: 4px 4px 0px #000;
      font-family: 'Bangers', cursive;
      letter-spacing: 2px;
      transform: rotate(-2deg);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .btn-post:hover {
      transform: rotate(0deg) scale(1.05);
      box-shadow: 6px 6px 0px #000;
    }
    .gallery {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 2rem;
      padding: 1rem;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    .photo-container {
      position: relative;
      width: 220px;
      height: 280px;
      background-color: #fff;
      padding: 10px 10px 40px 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.7);
      transform: rotate(-2deg);
      transition: all 0.3s ease;
      margin: 10px;
    }
    .photo-container:nth-child(odd) {
      transform: rotate(3deg);
    }
    .photo-container:hover {
      transform: scale(1.05) rotate(0);
      z-index: 10;
      box-shadow: 0 10px 25px rgba(0,0,0,0.8);
    }
    .photo {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    .photo-caption {
      position: absolute;
      bottom: 15px;
      left: 0;
      width: 100%;
      text-align: center;
      font-family: 'Permanent Marker', cursive;
      font-size: 0.9rem;
      color: #333;
    }
    .photo-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%);
      pointer-events: none;
    }
    /* Effet de scotch sur les polaroids */
    .photo-container::after {
      content: '';
      position: absolute;
      width: 40px;
      height: 15px;
      background-color: rgba(255, 255, 255, 0.5);
      top: -5px;
      left: 50%;
      transform: translateX(-50%) rotate(2deg);
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    .photo-container:nth-child(odd)::after {
      top: auto;
      bottom: 20px;
      left: -5px;
      transform: translateX(0) rotate(90deg);
    }
    .photo-container:nth-child(3n)::after {
      top: auto;
      bottom: 20px;
      left: auto;
      right: -5px;
      transform: translateX(0) rotate(-90deg);
    }
    .char {
      position: fixed;
      z-index: 5;
    }
    .top-right {
      right: 0;
      width: 300px; /* Personnage plus grand */
      transition: top 0.3s ease-out, transform 0.3s ease-out;
      transform-origin: top right;
    }
    .bottom-left {
      bottom: 10px;
      left: 10px;
      width: 140px;
    }
    
    /* Styles pour les modales */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background-color: #222;
      border: 3px solid #f5c400;
      border-radius: 15px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
      position: relative;
      transform: translateY(-50px);
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }
    
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5rem;
      color: #f5c400;
      cursor: pointer;
      background: none;
      border: none;
    }
    
    .modal-title {
      font-size: 2rem;
      color: #f5c400;
      margin-bottom: 1.5rem;
      text-shadow: 3px 3px 0 #000;
    }
    
    .wallet-btn {
      background-color: #f5c400;
      color: #000;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      cursor: pointer;
      margin: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 3px 3px 0 #000;
    }
    
    .wallet-btn:hover {
      transform: scale(1.05);
      box-shadow: 5px 5px 0 #000;
    }
    
    .wallet-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .wallet-option {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 200px;
      background-color: #333;
      color: #fff;
      border: 2px solid #f5c400;
    }
    
    .wallet-option:hover {
      background-color: #444;
    }
    
    .wallet-icon {
      width: 24px;
      height: 24px;
      margin-right: 10px;
    }
    
    .wallet-not-available {
      opacity: 0.6;
      cursor: default;
    }
    
    .wallet-not-available:hover {
      transform: none;
      box-shadow: 3px 3px 0 #000;
    }
    
    .wallet-option small {
      font-size: 0.7rem;
      opacity: 0.8;
      display: block;
      margin-top: 3px;
    }
    
    .wallet-status {
      margin-top: 1rem;
      font-family: 'Bangers', cursive;
      color: #fff;
    }
    
    .wallet-address {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 0.5rem;
      border-radius: 5px;
      font-family: monospace;
      font-size: 0.9rem;
      word-break: break-all;
      margin-top: 0.5rem;
    }
    
    /* Styles pour le formulaire de téléchargement */
    .upload-form {
      margin-top: 1.5rem;
    }
    
    .file-input-container {
      position: relative;
      margin-bottom: 1rem;
    }
    
    .file-input-label {
      display: inline-block;
      background-color: #333;
      color: #f5c400;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Bangers', cursive;
      transition: all 0.3s ease;
    }
    
    .file-input-label:hover {
      background-color: #444;
    }
    
    .file-input {
      position: absolute;
      left: -9999px;
    }
    
    .file-name {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #ccc;
    }
    
    .submit-btn {
      background-color: #f5c400;
      color: #000;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 3px 3px 0 #000;
    }
    
    .submit-btn:hover {
      transform: scale(1.05);
      box-shadow: 5px 5px 0 #000;
    }
    
    /* Styles pour les onglets d'upload */
    .upload-options {
      margin-top: 1rem;
    }
    
    .upload-option-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 1.5rem;
    }
    
    .upload-tab {
      background-color: #333;
      color: #fff;
      border: none;
      padding: 0.6rem 1.2rem;
      font-family: 'Bangers', cursive;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .upload-tab:first-child {
      border-radius: 10px 0 0 10px;
      border-right: 1px solid #222;
    }
    
    .upload-tab:last-child {
      border-radius: 0 10px 10px 0;
      border-left: 1px solid #222;
    }
    
    .upload-tab.active {
      background-color: #f5c400;
      color: #000;
    }
    
    .upload-option-content {
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: 1.5rem;
    }
    
    /* Styles pour les champs de légende et pseudo */
    .caption-input-container, .nickname-input-container {
      margin-bottom: 1.5rem;
    }
    
    .caption-label {
      display: block;
      margin-bottom: 0.5rem;
      font-family: 'Bangers', cursive;
      color: #f5c400;
    }
    
    .caption-input {
      width: 100%;
      padding: 0.8rem;
      border-radius: 5px;
      border: 2px solid #444;
      background-color: #222;
      color: #fff;
      font-family: 'Permanent Marker', cursive;
      font-size: 0.9rem;
    }
    
    .caption-input:focus {
      border-color: #f5c400;
      outline: none;
    }
    
    .caption-counter {
      text-align: right;
      font-size: 0.8rem;
      color: #aaa;
      margin-top: 0.3rem;
    }
    
    /* Styles pour les votes */
    .vote-btn {
      background-color: transparent;
      border: 2px solid #f5c400;
      color: #f5c400;
      padding: 0.3rem 0.8rem;
      border-radius: 5px;
      font-family: 'Bangers', cursive;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 0.5rem;
    }
    
    .vote-btn:hover {
      background-color: #f5c400;
      color: #000;
    }
    
    .vote-count {
      display: inline-block;
      background-color: #f5c400;
      color: #000;
      padding: 0.2rem 0.5rem;
      border-radius: 50%;
      font-size: 0.8rem;
      margin-left: 0.5rem;
      font-weight: bold;
    }
    
    /* Animation pour les notifications */
    @keyframes notification-pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #ff4d4d;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: notification-pulse 1.5s infinite;
    }
    
    /* Styles pour la section de vote */
    #voting {
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      margin: 2rem auto;
      max-width: 1200px;
      padding: 2rem;
    }
    
    .connect-prompt {
      background-color: rgba(245, 196, 0, 0.1);
      border: 2px dashed #f5c400;
      border-radius: 10px;
      padding: 1.5rem;
      margin: 2rem auto;
      max-width: 600px;
      text-align: center;
    }
    
    .connect-prompt p {
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    .or-text {
      font-family: 'Bangers', cursive;
      color: #f5c400;
      margin: 1rem 0;
      font-size: 1.5rem;
      text-shadow: 2px 2px 0 #000;
    }
    
    .alt-btn {
      background-color: #333 !important;
      color: #f5c400 !important;
      border: 2px solid #f5c400 !important;
    }
    
    .voting-gallery {
      margin-top: 2rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      position: relative;
      min-height: 500px;
    }
    
    .voting-gallery .photo-container {
      position: absolute;
      width: 220px;
      height: 300px;
      background-color: #fff;
      padding: 10px 10px 60px 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.7);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    /* Positions et rotations aléatoires pour les polaroids */
    .voting-gallery .photo-container:nth-child(1) { transform: rotate(-5deg); top: 20px; left: 10%; }
    .voting-gallery .photo-container:nth-child(2) { transform: rotate(3deg); top: 60px; left: 35%; }
    .voting-gallery .photo-container:nth-child(3) { transform: rotate(-2deg); top: 30px; right: 10%; }
    .voting-gallery .photo-container:nth-child(4) { transform: rotate(4deg); top: 180px; left: 5%; }
    .voting-gallery .photo-container:nth-child(5) { transform: rotate(-3deg); top: 220px; left: 30%; }
    .voting-gallery .photo-container:nth-child(6) { transform: rotate(2deg); top: 190px; right: 5%; }
    .voting-gallery .photo-container:nth-child(7) { transform: rotate(-4deg); top: 350px; left: 15%; }
    .voting-gallery .photo-container:nth-child(8) { transform: rotate(5deg); top: 380px; left: 40%; }
    .voting-gallery .photo-container:nth-child(9) { transform: rotate(-1deg); top: 340px; right: 15%; }
    
    .voting-gallery .photo-container:hover {
      transform: scale(1.05) rotate(0);
      z-index: 20;
      box-shadow: 0 10px 25px rgba(0,0,0,0.8);
    }
    
    /* Style pour le polaroid agrandi */
    .photo-enlarged {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1.5);
      z-index: 100;
      background-color: #fff;
      padding: 15px 15px 80px 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.8);
      max-width: 90vw;
      max-height: 90vh;
    }
    
    /* Overlay pour le fond sombre quand une photo est agrandie */
    .photo-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 99;
      display: none;
    }
    
    .voting-gallery .photo {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    
    .voting-gallery .photo-caption {
      position: absolute;
      bottom: 35px;
      left: 0;
      width: 100%;
      text-align: center;
      font-family: 'Permanent Marker', cursive;
      font-size: 0.9rem;
      color: #333;
    }
    
    .vote-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: absolute;
      bottom: 5px;
      left: 0;
      width: 100%;
    }
    
    .wallet-info {
      font-family: monospace;
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.3rem;
    }
    
    /* Effet de scotch sur les polaroids du concours */
    .voting-gallery .photo-container::after {
      content: '';
      position: absolute;
      width: 40px;
      height: 15px;
      background-color: rgba(255, 255, 255, 0.5);
      top: -5px;
      left: 50%;
      transform: translateX(-50%) rotate(2deg);
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    
    .voting-gallery .photo-container:nth-child(odd)::after {
      top: auto;
      bottom: 20px;
      left: -5px;
      transform: translateX(0) rotate(90deg);
    }
    
    .voting-gallery .photo-container:nth-child(3n)::after {
      top: auto;
      bottom: 20px;
      left: auto;
      right: -5px;
      transform: translateX(0) rotate(-90deg);
    }
    
    /* Badge "Nouveau" pour les nouvelles photos */
    .new-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background-color: #f5c400;
      color: #000;
      font-family: 'Bangers', cursive;
      padding: 5px 10px;
      border-radius: 5px;
      transform: rotate(5deg);
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      z-index: 5;
      font-size: 0.8rem;
    }
    
    /* Bouton "Voir plus" */
    .more-photos-btn {
      position: absolute;
      bottom: -50px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #f5c400;
      color: #000;
      font-family: 'Bangers', cursive;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 3px 3px 0 #000;
      transition: all 0.3s ease;
    }
    
    .more-photos-btn:hover {
      transform: translateX(-50%) scale(1.05);
      box-shadow: 5px 5px 0 #000;
    }
    
    /* Styles pour la vue en grille de toutes les photos */
    .all-photos-content {
      max-width: 90% !important;
      width: 90% !important;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .all-photos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    
    .grid-item {
      position: relative !important;
      top: auto !important;
      left: auto !important;
      right: auto !important;
      transform: rotate(0deg) !important;
      width: 100% !important;
      height: auto !important;
      margin: 0 !important;
    }
    
    .grid-item .photo {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    
    .grid-item .photo-caption {
      position: relative;
      bottom: auto;
      margin-top: 10px;
    }
    
    .grid-item .vote-info {
      position: relative;
      bottom: auto;
      margin-top: 10px;
    }
    
    /* Styles pour la modale de vote */
    .vote-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 1rem 0;
      background-color: #fff;
      padding: 10px 10px 30px 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      transform: rotate(-2deg);
      max-width: 250px;
      margin: 1.5rem auto;
    }
    
    .vote-preview-img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    
    /* Styles pour la modale de vote */
    .vote-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #fff;
      padding: 10px 10px 30px 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      transform: rotate(-2deg);
      max-width: 250px;
      margin: 1.5rem auto;
    }
    
    .vote-preview-img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    
    .vote-wallet-buttons {
      margin-top: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }
    
    .contest-info {
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      padding: 1.5rem;
      margin: 2rem auto;
      max-width: 800px;
    }
    
    .section-intro {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      text-align: center;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .contest-info h3 {
      color: #f5c400;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 0 #000;
    }
    
    .contest-info ol {
      text-align: left;
      padding-left: 2rem;
      margin-bottom: 1.5rem;
    }
    
    .contest-info li {
      font-family: 'Bangers', cursive;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #fff;
    }
    
    #contest-countdown {
      background-color: #f5c400;
      color: #000;
      padding: 0.3rem 0.8rem;
      border-radius: 5px;
      font-weight: bold;
      font-family: 'Bangers', cursive;
    }
  </style>
</head>
<body>
  <!-- Personnages -->
  <img src="persohaut.png" alt="Perso Haut" class="char top-right">
  <img src="persobas.png" alt="Perso Bas" class="char bottom-left">

  <!-- Header avec titre seulement -->
  <header>
    <div class="title-banner">CLCH</div>
  </header>

  <!-- Navigation -->
  <nav>
    <a href="#home">Accueil</a>
    <a href="#gallery">Galerie</a>
    <a href="#voting">Concours</a>
    <a href="#about">À propos</a>
    <a href="#contact">Contact</a>
  </nav>

  <!-- Home Section -->
  <section id="home">
    <div class="hero-text">
      POSTE TA PHOTO EN CLAQUETTES-CHAUSSETTES<br>
      ET ENTRE DANS LA LÉGENDE !
    </div>
    <a href="#" class="btn-post" onclick="openUploadModal(); return false;">POSTER UNE PHOTO</a>
  </section>

  <!-- Gallery Section -->
  <section id="gallery">
    <h2>GALERIE DES BOSS</h2>
    <div class="gallery">
      <div class="photo-container">
        <img src="claquette.jpg" alt="Exemple 1" class="photo">
        <div class="photo-caption">Le Boss Original</div>
      </div>
      <div class="photo-container">
        <img src="https://i.imgur.com/y06U1pK.jpg" alt="Exemple 2" class="photo">
        <div class="photo-caption">Style Urbain</div>
      </div>
      <div class="photo-container">
        <img src="https://i.imgur.com/FZbByRy.jpg" alt="Exemple 3" class="photo">
        <div class="photo-caption">Claquettes de Légende</div>
      </div>
      <div class="photo-container">
        <img src="https://i.imgur.com/X3R5gTx.jpg" alt="Exemple 4" class="photo">
        <div class="photo-caption">Vibe Estivale</div>
      </div>
    </div>
  </section>
  
  <!-- Concours Section -->
  <section id="voting">
    <h2>CONCOURS CLCH</h2>
    <p class="section-intro">Participe au concours, vote pour tes photos préférées et gagne des jetons CLCH !</p>
    
    <div class="connect-prompt" id="voting-connect-prompt">
      <p>Connecte ton wallet pour voter et gagner des jetons CLCH !</p>
      <button class="wallet-btn" onclick="openModal('wallet-modal')">CONNECTER TON WALLET</button>
    </div>
    
    <div class="gallery voting-gallery" id="voting-gallery">
      <!-- Les photos du concours seront chargées dynamiquement ici -->
    </div>
    
    <!-- Message affiché quand il n'y a pas encore de photos -->
    <div id="no-photos-message" style="display: none;">
      <p>Aucune photo n'a encore été soumise au concours. Sois le premier à poster ta photo !</p>
      <button class="wallet-btn" onclick="openUploadModal()">POSTER UNE PHOTO</button>
    </div>
    
    <div class="contest-info">
      <h3>COMMENT ÇA MARCHE ?</h3>
      <ol>
        <li>Connecte ton wallet ou poste en tant qu'invité</li>
        <li>Vote pour ta photo préférée</li>
        <li>Le gagnant remporte des jetons CLCH</li>
        <li>Les votants connectés reçoivent aussi des jetons !</li>
      </ol>
      <p>Le concours se termine dans <span id="contest-countdown">3 jours 12 heures</span></p>
      <button class="wallet-btn" onclick="openUploadModal()">POSTER TA PHOTO</button>
    </div>
  </section>

  <!-- About Section -->
  <section id="about">
    <h2>À PROPOS DE CLCH</h2>
    <p>CLCH est un mouvement, un style, un jeton, une vibe. Rejoins-nous et montre ton style avec claquettes et chaussettes. Tous les boss sont là !</p>
  </section>



  <!-- Contact Section -->
  <section id="contact">
    <h2>CONTACT</h2>
    <p>Pour nous contacter, rejoins notre communauté sur Telegram, X (Twitter), ou envoie-nous un message !</p>
  </section>

  <!-- Modales -->
  <!-- Modale de connexion Wallet -->
  <div id="wallet-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('wallet-modal')">✕</button>
      <h3 class="modal-title">CONNECTE TON WALLET</h3>
      <p>Pour poster ta photo ou voter, connecte-toi avec ton wallet.</p>
      <div class="wallet-buttons">
        <button class="wallet-btn wallet-option" data-wallet="metamask">
          <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="wallet-icon">
          MetaMask
        </button>
        <button class="wallet-btn wallet-option" data-wallet="walletconnect">
          <img src="https://seeklogo.com/images/W/walletconnect-logo-EE83B50C97-seeklogo.com.png" alt="WalletConnect" class="wallet-icon">
          WalletConnect
        </button>
        <button class="wallet-btn wallet-option" data-wallet="coinbase">
          <img src="https://seeklogo.com/images/C/coinbase-coin-logo-C86F46D7B8-seeklogo.com.png" alt="Coinbase" class="wallet-icon">
          Coinbase Wallet
        </button>
        <button class="wallet-btn wallet-option" data-wallet="trustwallet">
          <img src="https://trustwallet.com/assets/images/media/assets/trust_platform.png" alt="Trust Wallet" class="wallet-icon">
          Trust Wallet
        </button>
      </div>
      <div id="wallet-status" class="wallet-status"></div>
    </div>
  </div>

  <!-- Modale de téléchargement de photo -->
  <div id="upload-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('upload-modal')">✕</button>
      <h3 class="modal-title">POSTE TA PHOTO</h3>
      <p>Montre ton style en claquettes-chaussettes !</p>
      
      <div class="upload-options">
        <div class="upload-option-tabs">
          <button id="wallet-tab" class="upload-tab active" onclick="switchUploadTab('wallet')">AVEC WALLET</button>
          <button id="guest-tab" class="upload-tab" onclick="switchUploadTab('guest')">SANS WALLET</button>
        </div>
        
        <!-- Option avec wallet -->
        <div id="wallet-upload-option" class="upload-option-content">
          <div id="upload-wallet-required" style="display: none;">
            <p>Connecte ton wallet pour gagner des jetons CLCH si ta photo est populaire !</p>
            <button class="wallet-btn" onclick="openModal('wallet-modal'); closeModal('upload-modal');">CONNECTER TON WALLET</button>
          </div>
          <div id="upload-form-container" style="display: none;">
            <form id="upload-form" class="upload-form">
              <div class="file-input-container">
                <label for="photo-upload" class="file-input-label">CHOISIR UNE PHOTO</label>
                <input type="file" id="photo-upload" class="file-input" accept="image/*">
                <div id="file-name" class="file-name">Aucun fichier sélectionné</div>
              </div>
              <div class="caption-input-container">
                <label for="photo-caption" class="caption-label">TA LÉGENDE</label>
                <input type="text" id="photo-caption" class="caption-input" placeholder="Décris ton style CLCH..." maxlength="30">
                <div class="caption-counter">0/30</div>
              </div>
              <button type="submit" class="submit-btn">ENVOYER</button>
            </form>
          </div>
        </div>
        
        <!-- Option sans wallet (invité) -->
        <div id="guest-upload-option" class="upload-option-content" style="display: none;">
          <p>Poste ta photo sans wallet, mais tu ne pourras pas gagner de jetons CLCH.</p>
          <form id="guest-upload-form" class="upload-form">
            <div class="file-input-container">
              <label for="guest-photo-upload" class="file-input-label">CHOISIR UNE PHOTO</label>
              <input type="file" id="guest-photo-upload" class="file-input" accept="image/*">
              <div id="guest-file-name" class="file-name">Aucun fichier sélectionné</div>
            </div>
            <div class="caption-input-container">
              <label for="guest-photo-caption" class="caption-label">TA LÉGENDE</label>
              <input type="text" id="guest-photo-caption" class="caption-input" placeholder="Décris ton style CLCH..." maxlength="30">
              <div class="guest-caption-counter">0/30</div>
            </div>
            <div class="nickname-input-container">
              <label for="guest-nickname" class="caption-label">TON PSEUDO</label>
              <input type="text" id="guest-nickname" class="caption-input" placeholder="Ton pseudo..." maxlength="20">
            </div>
            <button type="submit" class="submit-btn">ENVOYER</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modale de confirmation -->
  <div id="confirmation-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('confirmation-modal')">✕</button>
      <h3 class="modal-title">MERCI BOSS !</h3>
      <p>Ta photo a été envoyée pour validation. Si elle est approuvée, elle apparaîtra dans la galerie et tu pourras recevoir des votes !</p>
      <button class="wallet-btn" onclick="closeModal('confirmation-modal')">OK</button>
    </div>
  </div>

  <script>
    // Script pour faire remonter le personnage en haut à droite lors du défilement
    document.addEventListener('DOMContentLoaded', function() {
      const persoHaut = document.querySelector('.top-right');
      
      // Position initiale du personnage
      persoHaut.style.top = '0px';
      
      // Fonction pour gérer le défilement
      window.addEventListener('scroll', function() {
        // Récupérer la position de défilement
        const scrollPosition = window.scrollY;
        
        // Calculer la nouvelle position du personnage
        // Plus on défile vers le bas, plus le personnage remonte
        const newPosition = Math.min(0, -scrollPosition * 0.5);
        
        // Calculer la rotation du personnage (jusqu'à 15 degrés max)
        const rotation = Math.min(15, scrollPosition * 0.05);
        
        // Appliquer la nouvelle position et rotation
        persoHaut.style.top = newPosition + 'px';
        persoHaut.style.transform = `rotate(${rotation}deg)`;
      });

      // Détecter les wallets disponibles
      detectWallets();
      
      // Initialisation de WalletConnect
      initWalletConnect();
      
      // Initialisation du formulaire de téléchargement
      initUploadForm();
      
      // Initialisation de Firebase pour les notifications
      initFirebase();
      
      // Simuler l'ajout périodique de nouvelles photos (pour la démo)
      simulateNewPhotos();
    });
    
    // Fonction pour simuler l'ajout de nouvelles photos périodiquement
    function simulateNewPhotos() {
      // Nouvelles photos à ajouter périodiquement
      const newPhotosSamples = [
        {
          url: "https://i.imgur.com/JKdiPVN.jpg",
          caption: "CLCH Sportif",
          wallet: "0x9f23...67a1"
        },
        {
          url: "https://i.imgur.com/8zVVbRJ.jpg",
          caption: "CLCH Casual",
          wallet: "0x2d45...91c3"
        },
        {
          url: "https://i.imgur.com/pKS28s4.jpg",
          caption: "CLCH Élégant",
          wallet: "0x7b19...34e2"
        }
      ];
      
      // Ajouter une nouvelle photo toutes les 30 secondes (pour la démo)
      let photoIndex = 0;
      
      function addNewPhoto() {
        if (photoIndex >= newPhotosSamples.length) return;
        
        const newPhoto = newPhotosSamples[photoIndex];
        const newPhotoId = 100 + contestPhotos.length + 1;
        
        // Créer une nouvelle entrée de photo
        contestPhotos.unshift({
          id: newPhotoId,
          url: newPhoto.url,
          caption: newPhoto.caption,
          votes: Math.floor(Math.random() * 10), // Votes aléatoires
          wallet: newPhoto.wallet,
          timestamp: new Date()
        });
        
        // Recharger les photos si l'utilisateur est connecté
        if (userAddress) {
          loadContestPhotos();
          
          // Notification
          if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('Nouvelle photo CLCH', {
              body: `Une nouvelle photo "${newPhoto.caption}" vient d'être ajoutée !`,
              icon: '/favicon.ico'
            });
          }
        }
        
        photoIndex++;
        
        // Programmer l'ajout de la prochaine photo
        if (photoIndex < newPhotosSamples.length) {
          setTimeout(addNewPhoto, 30000); // 30 secondes
        }
      }
      
      // Commencer à ajouter des photos après 15 secondes
      setTimeout(addNewPhoto, 15000);
    }
    
    // Fonction pour détecter les wallets disponibles
    function detectWallets() {
      // Détecter MetaMask
      const hasMetaMask = typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask;
      const metamaskButton = document.querySelector('.wallet-option[data-wallet="metamask"]');
      
      if (!hasMetaMask && metamaskButton) {
        metamaskButton.innerHTML += ' <small>(non installé)</small>';
        metamaskButton.classList.add('wallet-not-available');
      }
      
      // Détecter Coinbase Wallet
      const hasCoinbaseWallet = typeof window.ethereum !== 'undefined' && window.ethereum.isCoinbaseWallet;
      const coinbaseButton = document.querySelector('.wallet-option[data-wallet="coinbase"]');
      
      if (!hasCoinbaseWallet && coinbaseButton) {
        coinbaseButton.innerHTML += ' <small>(non installé)</small>';
        coinbaseButton.classList.add('wallet-not-available');
      }
    }

    // Variables globales
    let web3Modal;
    let provider;
    let web3;
    let userAddress = null;
    
    // Fonctions pour les modales
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    function openUploadModal() {
      // Par défaut, afficher l'onglet wallet
      switchUploadTab('wallet');
      
      // Si l'utilisateur est connecté, afficher le formulaire wallet
      if (userAddress) {
        document.getElementById('upload-wallet-required').style.display = 'none';
        document.getElementById('upload-form-container').style.display = 'block';
      } else {
        // Sinon, afficher le message pour se connecter
        document.getElementById('upload-wallet-required').style.display = 'block';
        document.getElementById('upload-form-container').style.display = 'none';
      }
      
      openModal('upload-modal');
    }
    
    // Fonction pour changer d'onglet dans la modale d'upload
    function switchUploadTab(tab) {
      // Mettre à jour les classes des onglets
      document.getElementById('wallet-tab').classList.toggle('active', tab === 'wallet');
      document.getElementById('guest-tab').classList.toggle('active', tab === 'guest');
      
      // Afficher le contenu correspondant
      document.getElementById('wallet-upload-option').style.display = tab === 'wallet' ? 'block' : 'none';
      document.getElementById('guest-upload-option').style.display = tab === 'guest' ? 'block' : 'none';
    }
    
    // Initialisation de WalletConnect
    function initWalletConnect() {
      // Configuration de Web3Modal avec les options de provider
      const providerOptions = {
        walletconnect: {
          package: WalletConnectProvider.default,
          options: {
            infuraId: "27e484dcd9e3efcfd25a83a78777cdf1", // Remplacer par votre Infura ID
            rpc: {
              1: "https://mainnet.infura.io/v3/27e484dcd9e3efcfd25a83a78777cdf1",
              56: "https://bsc-dataseed.binance.org/",
              137: "https://polygon-rpc.com/"
            }
          }
        }
      };
      
      // Créer l'instance Web3Modal
      web3Modal = new Web3Modal.default({
        cacheProvider: true,
        providerOptions,
        disableInjectedProvider: false,
        theme: "dark"
      });
      
      // Simplifier la connexion en utilisant directement les boutons
      document.querySelectorAll('.wallet-option').forEach(button => {
        button.addEventListener('click', async function() {
          const walletType = this.getAttribute('data-wallet');
          
          try {
            // Pour MetaMask et les wallets injectés
            if (walletType === 'metamask') {
              if (window.ethereum) {
                provider = window.ethereum;
                try {
                  // Demander à l'utilisateur de se connecter à MetaMask
                  await window.ethereum.request({ method: 'eth_requestAccounts' });
                  web3 = new Web3(window.ethereum);
                  const accounts = await web3.eth.getAccounts();
                  userAddress = accounts[0];
                  updateWalletStatus();
                  closeModal('wallet-modal');
                } catch (error) {
                  console.error("Erreur de connexion à MetaMask:", error);
                  alert("Erreur de connexion à MetaMask. Veuillez réessayer.");
                }
              } else {
                alert("MetaMask n'est pas installé. Veuillez installer l'extension MetaMask pour continuer.");
                window.open('https://metamask.io/download.html', '_blank');
              }
            } 
            // Pour WalletConnect
            else if (walletType === 'walletconnect') {
              const walletConnectProvider = new WalletConnectProvider.default({
                infuraId: "27e484dcd9e3efcfd25a83a78777cdf1",
                rpc: {
                  1: "https://mainnet.infura.io/v3/27e484dcd9e3efcfd25a83a78777cdf1",
                  56: "https://bsc-dataseed.binance.org/",
                  137: "https://polygon-rpc.com/"
                }
              });
              
              await walletConnectProvider.enable();
              provider = walletConnectProvider;
              web3 = new Web3(walletConnectProvider);
              const accounts = await web3.eth.getAccounts();
              userAddress = accounts[0];
              updateWalletStatus();
              closeModal('wallet-modal');
              
              // Écouter les événements
              provider.on("accountsChanged", (accounts) => {
                userAddress = accounts[0];
                updateWalletStatus();
              });
              
              provider.on("disconnect", () => {
                userAddress = null;
                updateWalletStatus();
              });
            }
            // Pour les autres wallets, utiliser Web3Modal
            else {
              connectWallet();
            }
          } catch (error) {
            console.error("Erreur de connexion au wallet:", error);
            alert("Erreur de connexion au wallet. Veuillez réessayer.");
          }
        });
      });
      
      // Vérifier si l'utilisateur était déjà connecté
      if (web3Modal.cachedProvider) {
        connectWallet();
      }
      
      // Mettre à jour l'affichage de la section de vote
      updateVotingSection();
    }
    
    // Connexion au wallet
    async function connectWallet(walletType) {
      return new Promise(async (resolve, reject) => {
        try {
          // Définir le provider en fonction du type de wallet
          if (walletType) {
            web3Modal.setCachedProvider(walletType);
          }
          
          provider = await web3Modal.connect();
          web3 = new Web3(provider);
          
          const accounts = await web3.eth.getAccounts();
          userAddress = accounts[0];
          
          updateWalletStatus();
          
          // Écouter les événements de changement de compte
          provider.on("accountsChanged", (accounts) => {
            userAddress = accounts[0];
            updateWalletStatus();
          });
          
          // Écouter les événements de déconnexion
          provider.on("disconnect", () => {
            userAddress = null;
            updateWalletStatus();
          });
          
          // Fermer la modale après connexion réussie
          closeModal('wallet-modal');
          
          // Résoudre la promesse avec l'adresse
          resolve(userAddress);
          
        } catch (error) {
          console.error("Erreur de connexion au wallet:", error);
          alert("Erreur de connexion au wallet. Veuillez réessayer.");
          reject(error);
        }
      });
    }
    
    // Mise à jour de l'affichage du statut du wallet
    function updateWalletStatus() {
      const walletStatus = document.getElementById('wallet-status');
      
      if (userAddress) {
        // Formater l'adresse pour l'affichage (ex: 0x1234...5678)
        const shortAddress = userAddress.substring(0, 6) + '...' + userAddress.substring(userAddress.length - 4);
        
        walletStatus.innerHTML = `
          <p>Connecté !</p>
          <div class="wallet-address">${shortAddress}</div>
          <button class="wallet-btn" onclick="disconnectWallet()">DÉCONNECTER</button>
        `;
        
        // Mettre à jour l'affichage du formulaire de téléchargement
        document.getElementById('upload-wallet-required').style.display = 'none';
        document.getElementById('upload-form-container').style.display = 'block';
        
        // Mettre à jour la section de vote
        updateVotingSection();
      } else {
        walletStatus.innerHTML = `<p>Non connecté</p>`;
        
        // Mettre à jour l'affichage du formulaire de téléchargement
        document.getElementById('upload-wallet-required').style.display = 'block';
        document.getElementById('upload-form-container').style.display = 'none';
        
        // Mettre à jour la section de vote
        updateVotingSection();
      }
    }
    
    // Déconnexion du wallet
    async function disconnectWallet() {
      if (provider && provider.close) {
        await provider.close();
      }
      
      if (web3Modal) {
        await web3Modal.clearCachedProvider();
      }
      
      userAddress = null;
      updateWalletStatus();
      
      // Fermer la modale de wallet après déconnexion
      closeModal('wallet-modal');
    }
    
    // Initialisation du formulaire de téléchargement
    function initUploadForm() {
      // Formulaire avec wallet
      const fileInput = document.getElementById('photo-upload');
      const fileName = document.getElementById('file-name');
      const captionInput = document.getElementById('photo-caption');
      const captionCounter = document.querySelector('.caption-counter');
      const uploadForm = document.getElementById('upload-form');
      
      // Formulaire invité
      const guestFileInput = document.getElementById('guest-photo-upload');
      const guestFileName = document.getElementById('guest-file-name');
      const guestCaptionInput = document.getElementById('guest-photo-caption');
      const guestCaptionCounter = document.querySelector('.guest-caption-counter');
      const guestNicknameInput = document.getElementById('guest-nickname');
      const guestUploadForm = document.getElementById('guest-upload-form');
      
      // Afficher le nom du fichier sélectionné (wallet)
      fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          fileName.textContent = this.files[0].name;
        } else {
          fileName.textContent = 'Aucun fichier sélectionné';
        }
      });
      
      // Afficher le nom du fichier sélectionné (invité)
      guestFileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          guestFileName.textContent = this.files[0].name;
        } else {
          guestFileName.textContent = 'Aucun fichier sélectionné';
        }
      });
      
      // Compteur de caractères pour la légende (wallet)
      captionInput.addEventListener('input', function() {
        captionCounter.textContent = `${this.value.length}/30`;
      });
      
      // Compteur de caractères pour la légende (invité)
      guestCaptionInput.addEventListener('input', function() {
        guestCaptionCounter.textContent = `${this.value.length}/30`;
      });
      
      // Soumission du formulaire (wallet)
      uploadForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!userAddress) {
          alert('Vous devez être connecté pour poster une photo avec votre wallet.');
          return;
        }
        
        if (!fileInput.files || !fileInput.files[0]) {
          alert('Veuillez sélectionner une photo.');
          return;
        }
        
        // Simuler l'envoi de la photo
        uploadPhoto(fileInput.files[0], captionInput.value, false);
      });
      
      // Soumission du formulaire (invité)
      guestUploadForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!guestFileInput.files || !guestFileInput.files[0]) {
          alert('Veuillez sélectionner une photo.');
          return;
        }
        
        if (!guestNicknameInput.value.trim()) {
          alert('Veuillez entrer un pseudo.');
          return;
        }
        
        // Simuler l'envoi de la photo
        uploadPhoto(guestFileInput.files[0], guestCaptionInput.value, true, guestNicknameInput.value);
      });
    }
    
    // Données des photos du concours (simulées pour la démo)
    const contestPhotos = [
      {
        id: 101,
        url: "https://i.imgur.com/dJWGthL.jpg",
        caption: "CLCH Aventurier",
        votes: 24,
        wallet: "0x7a23...45f9",
        isGuest: false,
        timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) // 7 jours avant
      },
      {
        id: 102,
        url: "https://i.imgur.com/QFPdNTk.jpg",
        caption: "CLCH Plage",
        votes: 18,
        wallet: "0x3b12...78d2",
        isGuest: false,
        timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000) // 3 jours avant
      },
      {
        id: 103,
        url: "https://i.imgur.com/Rk9sTfR.jpg",
        caption: "CLCH Urbain",
        votes: 31,
        wallet: "0x5f67...12e8",
        isGuest: false,
        timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000) // 5 jours avant
      },
      {
        id: 104,
        url: "https://i.imgur.com/JKdiPVN.jpg",
        caption: "CLCH Sportif",
        votes: 15,
        nickname: "SuperCLCH",
        isGuest: true,
        timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000) // 2 jours avant
      },
      {
        id: 105,
        url: "https://i.imgur.com/8zVVbRJ.jpg",
        caption: "CLCH Casual",
        votes: 27,
        nickname: "CLCHFan42",
        isGuest: true,
        timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000) // 1 jour avant
      },
      {
        id: 106,
        url: "https://i.imgur.com/pKS28s4.jpg",
        caption: "CLCH Élégant",
        votes: 19,
        wallet: "0x7b19...34e2",
        isGuest: false,
        timestamp: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000) // 4 jours avant
      }
    ];
    
    // Ajouter un overlay pour l'agrandissement des photos
    document.body.insertAdjacentHTML('beforeend', '<div id="photo-overlay" class="photo-overlay"></div>');
    
    // Fonction pour charger les photos du concours
    function loadContestPhotos() {
      const votingGallery = document.getElementById('voting-gallery');
      const noPhotosMessage = document.getElementById('no-photos-message');
      const photoOverlay = document.getElementById('photo-overlay');
      
      if (!votingGallery || !noPhotosMessage) return;
      
      // Vider la galerie
      votingGallery.innerHTML = '';
      
      // Si aucune photo, afficher le message
      if (contestPhotos.length === 0) {
        votingGallery.style.display = 'none';
        noPhotosMessage.style.display = 'block';
        return;
      }
      
      // Sinon, masquer le message et afficher les photos
      votingGallery.style.display = 'flex';
      noPhotosMessage.style.display = 'none';
      
      // Trier les photos par date (les plus récentes d'abord)
      const sortedPhotos = [...contestPhotos].sort((a, b) => b.timestamp - a.timestamp);
      
      // Limiter à 9 photos pour l'affichage en mur
      const displayPhotos = sortedPhotos.slice(0, 9);
      
      // Créer un élément pour chaque photo
      displayPhotos.forEach((photo, index) => {
        const photoElement = document.createElement('div');
        photoElement.className = 'photo-container';
        photoElement.setAttribute('data-photo-id', photo.id);
        
        // Vérifier si la photo est nouvelle (moins de 24 heures)
        const isNew = (Date.now() - photo.timestamp) < 24 * 60 * 60 * 1000;
        
        // Déterminer si c'est une photo d'invité ou de wallet
        const walletInfo = photo.isGuest 
          ? `<div class="wallet-info">Posté par: ${photo.nickname || 'Anonyme'}</div>`
          : `<div class="wallet-info">${photo.wallet}</div>`;
        
        photoElement.innerHTML = `
          <img src="${photo.url}" alt="${photo.caption}" class="photo">
          <div class="photo-caption">${photo.caption}</div>
          <div class="vote-info">
            <button class="vote-btn" onclick="event.stopPropagation(); voteForPhoto(${photo.id})">VOTER <span class="vote-count">${photo.votes}</span></button>
            ${walletInfo}
          </div>
          ${isNew ? '<div class="new-badge">NOUVEAU</div>' : ''}
        `;
        
        // Ajouter un gestionnaire d'événements pour agrandir la photo au clic
        photoElement.addEventListener('click', function() {
          enlargePhoto(photo);
        });
        
        votingGallery.appendChild(photoElement);
      });
      
      // Si plus de 9 photos, ajouter un bouton "Voir plus"
      if (sortedPhotos.length > 9) {
        const moreButton = document.createElement('div');
        moreButton.className = 'more-photos-btn';
        moreButton.innerHTML = `Voir ${sortedPhotos.length - 9} photos de plus`;
        moreButton.addEventListener('click', function() {
          showAllPhotos(sortedPhotos);
        });
        votingGallery.appendChild(moreButton);
      }
    }
    
    // Fonction pour agrandir une photo
    function enlargePhoto(photo) {
      const photoOverlay = document.getElementById('photo-overlay');
      
      // Créer l'élément de photo agrandie
      const enlargedElement = document.createElement('div');
      enlargedElement.className = 'photo-enlarged';
      enlargedElement.setAttribute('data-photo-id', photo.id);
      
      // Déterminer si c'est une photo d'invité ou de wallet
      const walletInfo = photo.isGuest 
        ? `<div class="wallet-info">Posté par: ${photo.nickname || 'Anonyme'}</div>`
        : `<div class="wallet-info">${photo.wallet}</div>`;
      
      enlargedElement.innerHTML = `
        <img src="${photo.url}" alt="${photo.caption}" class="photo" style="width: 100%; height: auto;">
        <div class="photo-caption">${photo.caption}</div>
        <div class="vote-info">
          <button class="vote-btn" onclick="voteForPhoto(${photo.id})">VOTER <span class="vote-count">${photo.votes}</span></button>
          ${walletInfo}
        </div>
      `;
      
      // Afficher l'overlay et la photo agrandie
      photoOverlay.style.display = 'block';
      photoOverlay.innerHTML = '';
      photoOverlay.appendChild(enlargedElement);
      
      // Fermer au clic sur l'overlay
      photoOverlay.addEventListener('click', function(e) {
        if (e.target === photoOverlay) {
          photoOverlay.style.display = 'none';
        }
      });
    }
    
    // Fonction pour afficher toutes les photos dans une vue en grille
    function showAllPhotos(photos) {
      const votingGallery = document.getElementById('voting-gallery');
      
      // Créer une modale pour afficher toutes les photos
      const allPhotosModal = document.createElement('div');
      allPhotosModal.className = 'modal-overlay active';
      allPhotosModal.id = 'all-photos-modal';
      
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content all-photos-content';
      
      modalContent.innerHTML = `
        <button class="modal-close" onclick="document.getElementById('all-photos-modal').remove()">✕</button>
        <h3 class="modal-title">TOUTES LES PHOTOS</h3>
        <div class="all-photos-grid"></div>
      `;
      
      allPhotosModal.appendChild(modalContent);
      document.body.appendChild(allPhotosModal);
      
      const photosGrid = document.querySelector('.all-photos-grid');
      
      // Ajouter toutes les photos à la grille
      photos.forEach(photo => {
        const photoElement = document.createElement('div');
        photoElement.className = 'photo-container grid-item';
        photoElement.setAttribute('data-photo-id', photo.id);
        
        // Vérifier si la photo est nouvelle (moins de 24 heures)
        const isNew = (Date.now() - photo.timestamp) < 24 * 60 * 60 * 1000;
        
        // Déterminer si c'est une photo d'invité ou de wallet
        const walletInfo = photo.isGuest 
          ? `<div class="wallet-info">Posté par: ${photo.nickname || 'Anonyme'}</div>`
          : `<div class="wallet-info">${photo.wallet}</div>`;
        
        photoElement.innerHTML = `
          <img src="${photo.url}" alt="${photo.caption}" class="photo">
          <div class="photo-caption">${photo.caption}</div>
          <div class="vote-info">
            <button class="vote-btn" onclick="event.stopPropagation(); voteForPhoto(${photo.id})">VOTER <span class="vote-count">${photo.votes}</span></button>
            ${walletInfo}
          </div>
          ${isNew ? '<div class="new-badge">NOUVEAU</div>' : ''}
        `;
        
        // Ajouter un gestionnaire d'événements pour agrandir la photo au clic
        photoElement.addEventListener('click', function() {
          enlargePhoto(photo);
        });
        
        photosGrid.appendChild(photoElement);
      });
    }
    
    // Fonction pour télécharger une photo
    function uploadPhoto(file, caption = "", isGuest = false, nickname = "") {
      // Ici, vous implémenteriez l'envoi réel de la photo à votre backend
      // Pour cette démo, nous simulons simplement un envoi réussi
      
      // Utiliser la légende fournie ou une légende par défaut
      const photoCaption = caption.trim() || "Ma CLCH Style";
      
      // Simuler un délai de chargement
      setTimeout(function() {
        // Créer une nouvelle entrée de photo
        const newPhotoId = 100 + contestPhotos.length + 1;
        const newPhoto = {
          id: newPhotoId,
          url: URL.createObjectURL(file), // Créer une URL temporaire pour l'image
          caption: photoCaption,
          votes: 0,
          isGuest: isGuest,
          timestamp: new Date()
        };
        
        // Ajouter les informations spécifiques selon le type d'utilisateur
        if (isGuest) {
          newPhoto.nickname = nickname;
        } else {
          newPhoto.wallet = userAddress.substring(0, 6) + '...' + userAddress.substring(userAddress.length - 4);
        }
        
        // Ajouter la photo à la liste
        contestPhotos.unshift(newPhoto);
        
        // Recharger les photos
        loadContestPhotos();
        
        // Fermer la modale de téléchargement
        closeModal('upload-modal');
        
        // Ouvrir la modale de confirmation
        openModal('confirmation-modal');
        
        // Envoyer une notification au propriétaire du site
        if (isGuest) {
          sendNotificationToOwner(file.name, nickname);
        } else {
          sendNotificationToOwner(file.name, userAddress);
        }
        
        // Réinitialiser les formulaires
        document.getElementById('upload-form').reset();
        document.getElementById('file-name').textContent = 'Aucun fichier sélectionné';
        document.getElementById('photo-caption').value = '';
        document.querySelector('.caption-counter').textContent = '0/30';
        
        document.getElementById('guest-upload-form').reset();
        document.getElementById('guest-file-name').textContent = 'Aucun fichier sélectionné';
        document.getElementById('guest-photo-caption').value = '';
        document.querySelector('.guest-caption-counter').textContent = '0/30';
        document.getElementById('guest-nickname').value = '';
        
        // Faire défiler jusqu'à la section de vote
        setTimeout(() => {
          document.getElementById('voting').scrollIntoView({ behavior: 'smooth' });
        }, 1000);
      }, 1500);
    }
    
    // Fonction pour mettre à jour l'affichage de la section de vote
    function updateVotingSection() {
      const connectPrompt = document.getElementById('voting-connect-prompt');
      const votingGallery = document.getElementById('voting-gallery');
      const noPhotosMessage = document.getElementById('no-photos-message');
      
      if (!connectPrompt || !votingGallery) {
        // Si les éléments n'existent pas encore, ne rien faire
        return;
      }
      
      // Toujours charger les photos du concours, qu'on soit connecté ou non
      loadContestPhotos();
      
      if (userAddress) {
        // Si l'utilisateur est connecté, masquer l'invite de connexion
        connectPrompt.style.display = 'none';
      } else {
        // Sinon, afficher l'invite de connexion mais laisser la galerie visible
        connectPrompt.style.display = 'block';
        // Modifier le texte pour indiquer qu'on peut aussi poster sans wallet
        connectPrompt.innerHTML = `
          <p>Connecte ton wallet pour voter et gagner des jetons CLCH !</p>
          <button class="wallet-btn" onclick="openModal('wallet-modal')">CONNECTER TON WALLET</button>
          <p class="or-text">- OU -</p>
          <button class="wallet-btn alt-btn" onclick="openUploadModal(); switchUploadTab('guest');">POSTER SANS WALLET</button>
        `;
      }
      
      // Mettre à jour le compte à rebours du concours
      updateContestCountdown();
    }
    
    // Fonction pour mettre à jour le compte à rebours du concours
    function updateContestCountdown() {
      // Date de fin du concours (exemple: dans 3 jours et 12 heures)
      const now = new Date();
      const endDate = new Date(now.getTime() + (3 * 24 * 60 * 60 * 1000) + (12 * 60 * 60 * 1000));
      
      // Calculer la différence
      const diff = endDate - now;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      
      // Mettre à jour l'affichage
      document.getElementById('contest-countdown').textContent = `${days} jours ${hours} heures`;
    }
    
    // Fonction pour voter pour une photo
    function voteForPhoto(photoId) {
      if (!userAddress) {
        // Si l'utilisateur n'est pas connecté, ouvrir une modale spéciale pour le vote
        showVoteConnectPrompt(photoId);
        return;
      }
      
      // Ici, vous implémenteriez l'envoi réel du vote à votre smart contract
      // Pour cette démo, nous simulons simplement un vote réussi
      
      // Trouver la photo dans notre tableau de données
      const photoIndex = contestPhotos.findIndex(photo => photo.id === photoId);
      if (photoIndex === -1) return;
      
      // Incrémenter le compteur de votes dans les données
      contestPhotos[photoIndex].votes++;
      
      // Trouver l'élément de comptage des votes dans le DOM
      const photoContainer = document.querySelector(`.photo-container[data-photo-id="${photoId}"]`);
      const voteCount = photoContainer.querySelector('.vote-count');
      
      // Mettre à jour l'affichage
      voteCount.textContent = contestPhotos[photoIndex].votes;
      
      // Animation pour indiquer que le vote a été pris en compte
      voteCount.style.animation = 'notification-pulse 0.5s';
      setTimeout(() => {
        voteCount.style.animation = '';
      }, 500);
      
      // Afficher un message de confirmation
      alert(`Merci d'avoir voté ! Tu recevras bientôt des jetons CLCH pour ta participation.`);
    }
    
    // Fonction pour afficher une invite de connexion spécifique au vote
    function showVoteConnectPrompt(photoId) {
      // Créer une modale spéciale pour le vote
      const voteModal = document.createElement('div');
      voteModal.className = 'modal-overlay active';
      voteModal.id = 'vote-connect-modal';
      
      // Trouver la photo concernée
      const photo = contestPhotos.find(p => p.id === photoId);
      if (!photo) return;
      
      voteModal.innerHTML = `
        <div class="modal-content">
          <button class="modal-close" onclick="document.getElementById('vote-connect-modal').remove()">✕</button>
          <h3 class="modal-title">VOTE POUR CETTE PHOTO</h3>
          <div class="vote-preview">
            <img src="${photo.url}" alt="${photo.caption}" class="vote-preview-img">
            <div class="photo-caption">${photo.caption}</div>
          </div>
          <p>Pour voter et gagner des jetons CLCH, tu dois te connecter avec ton wallet.</p>
          <div class="wallet-buttons vote-wallet-buttons">
            <button class="wallet-btn wallet-option" data-wallet="metamask" onclick="connectForVote('metamask', ${photoId})">
              <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="wallet-icon">
              MetaMask
            </button>
            <button class="wallet-btn wallet-option" data-wallet="walletconnect" onclick="connectForVote('walletconnect', ${photoId})">
              <img src="https://seeklogo.com/images/W/walletconnect-logo-EE83B50C97-seeklogo.com.png" alt="WalletConnect" class="wallet-icon">
              WalletConnect
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(voteModal);
    }
    
    // Fonction pour se connecter spécifiquement pour voter
    function connectForVote(walletType, photoId) {
      // Fermer la modale de vote
      const voteModal = document.getElementById('vote-connect-modal');
      if (voteModal) voteModal.remove();
      
      // Connecter le wallet
      connectWallet(walletType).then(() => {
        // Une fois connecté, voter automatiquement
        if (userAddress) {
          setTimeout(() => {
            voteForPhoto(photoId);
          }, 500);
        }
      }).catch(error => {
        console.error("Erreur lors de la connexion pour voter:", error);
      });
    }
    
    // Initialisation de Firebase pour les notifications
    function initFirebase() {
      // Configuration de Firebase avec vos identifiants
      const firebaseConfig = {
        apiKey: "AIzaSyDDTsKpifjFMSSJrn20Xc3q8szf27F2ZP0",
        authDomain: "clch-3a8f4.firebaseapp.com",
        databaseURL: "https://clch-3a8f4-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "clch-3a8f4",
        storageBucket: "clch-3a8f4.firebasestorage.app",
        messagingSenderId: "258957198457",
        appId: "1:258957198457:web:2998d1c0f6ba295f3080a8",
        measurementId: "G-NWT4D2D1ER"
      };
      
      // Initialiser Firebase
      firebase.initializeApp(firebaseConfig);
      
      // Demander la permission pour les notifications
      requestNotificationPermission();
      
      // Initialiser Firebase Messaging
      initMessaging();
    }
    
    // Fonction pour demander la permission des notifications
    function requestNotificationPermission() {
      if ('Notification' in window) {
        if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
          Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
              console.log('Notification permission granted.');
              // Vous pouvez initialiser votre service worker ici si nécessaire
            }
          });
        }
      }
    }
    
    // Initialiser Firebase Messaging
    function initMessaging() {
      try {
        const messaging = firebase.messaging();
        
        // Récupérer le token FCM
        messaging.getToken().then((currentToken) => {
          if (currentToken) {
            console.log('FCM Token:', currentToken);
            // Envoyer ce token à votre serveur pour enregistrer cet appareil
            saveTokenToDatabase(currentToken);
          } else {
            console.log('No registration token available. Request permission to generate one.');
            requestNotificationPermission();
          }
        }).catch((err) => {
          console.log('An error occurred while retrieving token. ', err);
        });
        
        // Écouter les messages en premier plan
        messaging.onMessage((payload) => {
          console.log('Message received in foreground:', payload);
          // Afficher une notification personnalisée
          const notificationTitle = payload.notification.title;
          const notificationOptions = {
            body: payload.notification.body,
            icon: '/favicon.ico'
          };
          
          new Notification(notificationTitle, notificationOptions);
        });
      } catch (error) {
        console.error("Erreur lors de l'initialisation de Firebase Messaging:", error);
      }
    }
    
    // Enregistrer le token dans la base de données Firebase
    function saveTokenToDatabase(token) {
      // Utiliser Firebase Realtime Database pour stocker le token
      const database = firebase.database();
      const tokenRef = database.ref('fcmTokens');
      
      // Générer un ID unique pour ce token
      const newTokenRef = tokenRef.push();
      
      // Enregistrer le token avec un timestamp
      newTokenRef.set({
        token: token,
        createdAt: firebase.database.ServerValue.TIMESTAMP,
        platform: navigator.platform,
        userAgent: navigator.userAgent
      }).then(() => {
        console.log('Token saved to database');
      }).catch(error => {
        console.error('Error saving token to database:', error);
      });
    }
    
    // Fonction pour envoyer une notification au propriétaire du site
    function sendNotificationToOwner(fileName, userAddress) {
      // Utiliser Firebase Realtime Database pour enregistrer la nouvelle photo
      try {
        const database = firebase.database();
        const photosRef = database.ref('pendingPhotos');
        
        // Créer une nouvelle entrée pour la photo en attente
        const newPhotoRef = photosRef.push();
        
        // Enregistrer les informations de la photo
        newPhotoRef.set({
          fileName: fileName,
          userAddress: userAddress,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          status: 'pending'
        }).then(() => {
          console.log('Photo information saved to database for approval');
          
          // Envoyer une notification locale si possible
          if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('Nouvelle photo CLCH', {
              body: `Une nouvelle photo a été envoyée par ${typeof userAddress === 'string' ? userAddress.substring(0, 6) + '...' : userAddress}`,
              icon: '/favicon.ico'
            });
          }
        }).catch(error => {
          console.error('Error saving photo information to database:', error);
        });
      } catch (error) {
        console.error('Error sending notification to owner:', error);
        
        // Fallback pour la démo
        console.log(`Notification: Nouvelle photo "${fileName}" envoyée par ${userAddress}`);
      }
    }
  </script>
</body>
</html>
